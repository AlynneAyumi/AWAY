option_settings:
  aws:elasticbeanstalk:application:environment:
    SERVER_PORT: 5000

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_start_away.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Iniciar aplicação Spring Boot
      cd /var/app/current
      nohup java -jar target/away-0.0.1-SNAPSHOT.jar > /var/log/away-backend.log 2>&1 &
      echo $! > /var/run/away-backend.pid

  "/opt/elasticbeanstalk/hooks/appdeploy/pre/99_stop_away.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Parar aplicação anterior
      if [ -f /var/run/away-backend.pid ]; then
        kill $(cat /var/run/away-backend.pid) 2>/dev/null || true
        rm -f /var/run/away-backend.pid
      fi
      pkill -f "away-0.0.1-SNAPSHOT.jar" || true

